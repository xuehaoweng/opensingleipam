FROM python:3.11.8-alpine3.19
RUN  apk --update add gcc g++ git curl build-base musl-dev linux-headers
COPY backend/ /app
COPY config/ /config
COPY web/default_menu.json /web/default_menu.json
# 再次切换工作目录为Django主目录
WORKDIR /app

# 安装项目所需python第三方库
# 指定setuptools的版本，必须指定，新版本有兼容问题
RUN set -ex \
    && pip install setuptools_scm==7.1.0 -i https://mirrors.aliyun.com/pypi/simple/ \
    && pip install --upgrade pip setuptools==57.5.0 -i https://mirrors.aliyun.com/pypi/simple/ \
    && pip install -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple/ \
    && rm -rf /var/cache/apk/* \
    && python manage.py collectstatic --noinput


EXPOSE 8000
EXPOSE 8001
CMD ["sh", "start.sh"]